# Covid Area Alerts App
<img src="https://img.shields.io/badge/node-v16.3.0-brightgreen"/> <img src="https://img.shields.io/badge/npm-v7.19.0-brightgreen"/> <img src="https://img.shields.io/badge/expo_cli-v4.7.2-brightgreen"/> <img src="https://img.shields.io/badge/aws_cli-v2.2.14-brightgreen"/><img src="https://img.shields.io/badge/amplify-v5.1.0-brightgreen"/>

This app tells you the restrictions on your current local authority area, it will also alert you when moving across local authority boundaries.

## Getting Started

### Prerequisites
Application uses Expo and AWS Amplify
```
npm install -g expo-cli
npm install -g @aws-amplify/cli
```
Tested with Node v16.3, reccomend using NVM for versioning until new Node versions are tested.

Amplify requires configuration once installed, during configuration it reccomends creating a user role with admin permissions to enable full functionality
```
amplify configure
```
Full walkthrough for Amplify is available [here](https://docs.amplify.aws/cli/start/install#install-the-amplify-cli).


### Setup
Clone the repo and then navigate to the folder
```
git clone https://github.com/Kainos-Applied-Innovation/covid-area-app && cd ./covid-area-app/
```

#### Backend
##### Fresh Project
If creating a new project initalise and setup a new amplify environment;
```
amplify init
```

The to create the backend resources in AWS, run;
```
amplify push
```

For now, until imporvements are made, you'll need to capture the API Endpoint and DB key and use those in the [scripts]("./scripts") to initise the storage.


##### Shared Project
If using a shared enviroment, the steps are different be sure to include the correct `amplify/team-provider-info.json` generated by amplify first, then run;
```
amplify init # and pick the correct environment
amplift pull
```

#### Frontend

Install expo in the repo, then use npm to install the relevant packages

```
expo install
npm install
```

then start the Babel build of the Front-End with;
```
expo start
```

If you have a real device you can install the Expo app from the App/Play store and then scan the QR code from the bundler app. You will need real devices in order to test push notifications.

## Running Tests
### Cypress tests
For End-to-end testing we currently use Cypress to run the testing suite.
In some Cypress tests, we request permission for the device’s location. As a result, you should run the tests using a browser - such as Chrome.

Before attempting to run Cypress tests, you must start the app and then click "Run in web browser":
```
expo start
```

Navigate to the project's root directory and enter the following into the console to run the tests:
```
npx cypress run --browser chrome
```

Cypress will generate a video for the most recent test run, which is useful when trying to work out why a test has failed. 
To view this, navigate to:
> covid-area-app/cypress/videos

### Jest and Enzyme tests
For testing the React component, both Jest and Enzyme are used.

Navigate to the project's root directory and enter the following into the console to run the tests:
```
npm test
```

Snapshot testing is useful as it ensures your UI doesn't change unexpectedly.
If you make any changes in the App.js file, you will need to update the Jest snapshot.
To do this, enter:
```
npm test -- -u
```

## Deployment
### Backend
Backend deployment is handled by Amplify;
```
amplify push
```

### Android
To run the app on your Android device, your device must be in Developer mode and you should install it using the APK file provided.

To enable developer mode:
1. Open the Settings app
2. Navigate to System settings > About phone
3. Tap on "Build Number" more than 5 times. You may then need to enter your phone's password.
4. Navigate back to the main Settings page, you will now see "Developer Options" listed
5. Tap on "Developer Options"
6. Scroll down to "USB Debugging" and enable it.

*Note: there may be minor variation between device manufacturers for the instructions above.*

If you have not done so already, please install the Android Platform Tools so that we can access the ADB.
If you have a Mac and have HomeBrew installed, you can enter the following:
```
brew install android-platform-tools
```

To install the app on your device:
1. Connect your device to your computer using a USB cable
2. Use the command below to check that your device is connected:
```
adb devices
```
3. Install the app, using your path to the APK file:
```
adb install /path/to/apk/file
```

### iOS
To run the app on your iOS device, your device must be registered with our Apple Developer account. You must do the following:

**Windows 10**

1. Connect your iOS device to the Windows 10 computer using a cable
2. Move your mouse to on top of the Windows icon (bottom left)
3. Right click on the Windows icon and select “Device Manager”
4. Scroll down the list until you see "Universal Serial Bus devices”
5. Expand the “Universal Serial Bus devices” option. If that option is not visible, check that the cable is connected to the iPhone & computer. If it’s still not visible, expand the “Universal Serial Bus controllers” option
6. In one of those options, you should now see “Apple Mobile Device”
7. Double click on “Apple Mobile Device”
8. Select the “Details” tab at the top
9. Change the Property drop down list to “Device Instance Path”
10. You will now see a very long value, right click on it and select copy
11. Send that long value to the person that manages the Apple Developer account. They will add your device UDID to the “Device” list and will then update the Provisioning Profile

**MacOS**

1. Connect your iOS device to the Mac using a cable
2. Open Finder and click on your device (it will be on the left hand side, under “Locations”)
3. Move your mouse on top of “iPhone …” eg. "iPhone 12 57GB (20 available) 85%”
4. Click once, you will now see the Serial Number & UDID
5. Do a Control + click and then click on “Copy UDID"
6. Send the UDID to the person that manages the Apple Developer account. They will add your device UDID to the “Device” list and will then update the Provisioning Profile

Once you've been added and a new .ipa file has been generated, you can now install the app. Follow the steps below:

**Windows 10**

1. Download the .ipa file
2. Open the Microsoft Store app and download iTunes
3. Open iTunes
4. Connect your iOS device to the computer using a cable. Click allow on the popup on your computer and tap on "Trust" on your iOS device.
5. Find the .ipa file on your computer, right click and copy it
6. Open iTunes again and place your mouse over the iOS device's name (eg. "Liam's iPhone"). It will be on the left hand side of the screen.
7. Right click and paste it
8. You will now see the download bar at the top of the iTunes window. If this does not happen, check that your device is connected to the computer and try pasting again. 
9. Your app should now be installed on the device. Open your iOS device and find it on the home screen.

**MacOS**

1. Download the .ipa file
2. Connect your iOS device to the Mac using a cable
3. Open Xcode
4. Navigate to the top bar & click on Window > Devices and Simulators
5. Navigate to the “Installed Apps” section and click on the + icon
6. Select the .ipa file on your machine

## Troubleshooting

***Council & Restrictions data is no longer showing in the app***
It's likely that the AppSync key has expired for GraphQL.

1. Open the AWS Console
2. Navigate to AppSync
3. Click on the API and select "Settings"
4. Change the expiry date for the API key

## To Do
Pending developments in a rough priority
* Testing (Amplify)
* Front-end and flow improvements
* [Offline Sync](https://aws.amazon.com/blogs/mobile/aws-appsync-offline-reference-architecture/)
* Cleaner Data Model
* Scrapping Sync

## Built With
* Expo
* Amplify
* Coffee

## Contributing
For changes, fork repo, create a feature branch, squash your commits and raise a PR!

Please read this [CONTRIBUTING.md](https://gist.github.com/PurpleBooth/b24679402957c63ec426) for details on a code of conduct, and the process for submitting pull requests to us until an indivuial guide as been developed for this project.

## Versioning
Current version: 0.1.0 (Active Development)

## Authors
* **Marc Nevin** - *Initial setup*
* **Liam McCormick** - *Jest & Cypress testing, generating APK file*

## License
TBA

## Acknowledgments

* Rebuild of the Scottish Tech Armys [project](https://github.com/Scottish-Tech-Army/covid-area-app)
